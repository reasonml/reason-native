<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mock Functions · Reason Native</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Mock functions (or &amp;quot;spies&amp;quot;) in Rely can be used to track information about the arguments and return values of functions, and allow for test-time configuration of return values. Rely has built-in matchers for dealing with mock functions that are documented extensively &lt;a href=&quot;/docs/rely/expect#expectmock&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mock Functions · Reason Native"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reason-native.com/index.html"/><meta property="og:description" content="&lt;p&gt;Mock functions (or &amp;quot;spies&amp;quot;) in Rely can be used to track information about the arguments and return values of functions, and allow for test-time configuration of return values. Rely has built-in matchers for dealing with mock functions that are documented extensively &lt;a href=&quot;/docs/rely/expect#expectmock&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
"/><meta property="og:image" content="https://reason-native.com/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://reason-native.com/img/docusaurus.png"/><link rel="shortcut icon" href="/img/logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script type="text/javascript" src="/js/ansi-to-html.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/ansi.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-inverted.svg" alt="Reason Native"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/help" target="_self">Help</a></li><li class=""><a href="https://github.com/facebookexperimental/reason-native" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Rely</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/native-basics">Native Basics</a></li><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Rely</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/rely/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/rely/quickstart">Quickstart</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Guides</h4><ul><li class="navListItem"><a class="navItem" href="/docs/rely/setup-teardown">Setup and Teardown</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/rely/mock-functions">Mock Functions</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">API Reference</h4><ul><li class="navListItem"><a class="navItem" href="/docs/rely/api">Basic API</a></li><li class="navListItem"><a class="navItem" href="/docs/rely/expect">Expect</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/rely/advanced">Advanced</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Console</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/console/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/console/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/console/api">API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pastel</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/pastel/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/pastel/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/pastel/api">API</a></li><li class="navListItem"><a class="navItem" href="/docs/pastel/console">Console</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Refmterr</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/refmterr/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/refmterr/quickstart">Quickstart</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">File Context Printer</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/file-context-printer/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/file-context-printer/quickstart">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/file-context-printer/api">API</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Mock Functions</h1></header><article><div><span><p>Mock functions (or &quot;spies&quot;) in Rely can be used to track information about the arguments and return values of functions, and allow for test-time configuration of return values. Rely has built-in matchers for dealing with mock functions that are documented extensively <a href="/docs/rely/expect#expectmock">here</a>.</p>
<blockquote>
<p>Unlike Jest in JavaScript, module level mocking is not supported. The functionality available in Rely is analagous to what Jest offers via <a href="https://jestjs.io/docs/en/jest-object#jestfnimplementation"><code>jest.fn</code> </a> and there is no direct <a href="https://jestjs.io/docs/en/jest-object#jestmockmodulename-factory-options"><code>jest.mock</code></a> analogy. Many situations in which <code>jest.mock</code> would be useful can be addressed through dependency management and the structuring of side effects within your application. A simple example using functors is shown <a href="#injecting-via-functor">below</a>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="using-mock-functions"></a><a href="#using-mock-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Mock Functions</h2>
<h3><a class="anchor" aria-hidden="true" id="creating-mocks"></a><a href="#creating-mocks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating Mocks</h3>
<p>There are constructors for creating mocks that take up to 7 arguments. A default implementation must be specified.</p>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">open</span> <span class="hljs-module-identifier">TestFramework</span>;

<span class="hljs-keyword">let</span> calculateInterest = <span class="hljs-module-identifier">Mock</span>.mock3((p, r, t) =&gt; p <span class="hljs-operator">*.</span> exp(r <span class="hljs-operator">*.</span> t));
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Mock</span>: {
  <span class="hljs-keyword">type</span> t('fn, 'returnType, 'tupledArgs);

  <span class="hljs-keyword">let</span> mock1: ('args =&gt; 'ret) =&gt; t('args =&gt; 'ret, 'ret, 'args);

  <span class="hljs-keyword">let</span> mock2:
    (('arg1, 'arg2) =&gt; 'ret) =&gt;
    t(('arg1, 'arg2) =&gt; 'ret, 'ret, ('arg1, 'arg2));

  <span class="hljs-keyword">let</span> mock3:
    (('arg1, 'arg2, 'arg3) =&gt; 'ret) =&gt;
    t(('arg1, 'arg2, 'arg3) =&gt; 'ret, 'ret, ('arg1, 'arg2, 'arg3));

  <span class="hljs-keyword">let</span> mock4:
    (('arg1, 'arg2, 'arg3, 'arg4) =&gt; 'ret) =&gt;
    t(
      ('arg1, 'arg2, 'arg3, 'arg4) =&gt; 'ret,
      'ret,
      ('arg1, 'arg2, 'arg3, 'arg4),
    );

  <span class="hljs-keyword">let</span> mock5:
    (('arg1, 'arg2, 'arg3, 'arg4, 'arg5) =&gt; 'ret) =&gt;
    t(
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5) =&gt; 'ret,
      'ret,
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5),
    );

  <span class="hljs-keyword">let</span> mock6:
    (('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6) =&gt; 'ret) =&gt;
    t(
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6) =&gt; 'ret,
      'ret,
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6),
    );

  <span class="hljs-keyword">let</span> mock7:
    (('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6, 'arg7) =&gt; 'ret) =&gt;
    t(
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6, 'arg7) =&gt; 'ret,
      'ret,
      ('arg1, 'arg2, 'arg3, 'arg4, 'arg5, 'arg6, 'arg7),
    );
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="calling-mock-functions"></a><a href="#calling-mock-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calling Mock Functions</h3>
<p>The <code>Mock.mockN</code> constructor returns a mutable opaque type for tracking call information. To access the underlying function, use <code>Mock.fn</code>.</p>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">open</span> <span class="hljs-module-identifier">TestFramework</span>;

describe(<span class="hljs-string">"Mock documentation"</span>, ({test}) =&gt; {
  test(<span class="hljs-string">"calling a mock function"</span>, ({expect}) =&gt; {
    <span class="hljs-keyword">let</span> mockDouble = <span class="hljs-module-identifier">Mock</span>.mock1(x =&gt; x <span class="hljs-operator">*</span> <span class="hljs-number">2</span>);
    <span class="hljs-keyword">let</span> mockFunction = <span class="hljs-module-identifier">Mock</span>.fn(mockDouble);

    expect.int(mockFunction(<span class="hljs-number">2</span>)).toBe(<span class="hljs-number">4</span>);
  })
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="injecting-via-functor"></a><a href="#injecting-via-functor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Injecting via Functor</h3>
<p>When testing code with side effects such as talking to a database or making network requests, it is often desirable to be able to mock out these side effects. A straightforward way of achieving this is by passing functions that perform side effects as arguments. However, this is not always desirable due to the problem of threading such arguments through deeply nested code. The use of module functions (functors) can accomplish a similar thing and somewhat alleviate this issue.</p>
<p>For example, suppose that we have some code that uses a logger. In production we want the logger to make HTTP requests to some endpoint, but we deem this behavior undesirable for our test.</p>
<p>Without abstracting away the dependendency on our HTTP logger, our code might look like this.</p>
<h4><a class="anchor" aria-hidden="true" id="mymodulere"></a><a href="#mymodulere" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MyModule.re</h4>
<pre><code class="hljs css language-reasonml"><span class="hljs-keyword">module</span> MyApp = {
  <span class="hljs-keyword">let</span> doSomethingThatGetsLogged =<span class="hljs-function"> <span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HTTPLogger</span>.</span></span>log(<span class="hljs-string">"starting to do someting"</span>);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SomeModule</span>.</span></span><span class="hljs-keyword">do</span><span class="hljs-constructor">Something()</span>;
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HTTPLogger</span>.</span></span>log(<span class="hljs-string">"did the thing!"</span>);
  };
};
</code></pre>
<p>Instead we could inject the code via a functor (module function) or via an ordinary function.</p>
<h4><a class="anchor" aria-hidden="true" id="mymodulere-1"></a><a href="#mymodulere-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MyModule.re</h4>
<pre><code class="hljs css language-reason {"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Make</span> = (<span class="hljs-module-identifier">Dependencies</span>: {<span class="hljs-keyword">let</span> log: string =&gt; unit;}) =&gt; {
  <span class="hljs-keyword">let</span> doSomethingThatGetsLogged = () =&gt; {
    <span class="hljs-module-identifier">Dependencies</span>.log(<span class="hljs-string">"starting to do something"</span>);
    <span class="hljs-module-identifier">SomeModule</span>.doSomething();
    <span class="hljs-module-identifier">Dependencies</span>.log(<span class="hljs-string">"did the thing!"</span>);
  };
};
<span class="hljs-comment">/*
 * Making the "real" versions of the module could easily be handled elsewhere
 *  in the application but is shown here for simplicity
 */</span>
<span class="hljs-keyword">include</span> <span class="hljs-module-identifier">Make</span>({
  <span class="hljs-comment">/*
   * Generally it would be better practice to have some Logger module type and
   * specify that there is a logger module in the functor signature, but for the
   * simplicity of this example we use a function instead
   */</span>
  <span class="hljs-keyword">let</span> log = <span class="hljs-module-identifier">HTTPLogger</span>.log;
});
</code></pre>
<p>In your tests you can do this</p>
<h4><a class="anchor" aria-hidden="true" id="mymoduletestre"></a><a href="#mymoduletestre" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MyModuleTest.re</h4>
<pre><code class="hljs css language-reason {"><span class="hljs-keyword">open</span> <span class="hljs-module-identifier">TestFramework</span>;

<span class="hljs-keyword">let</span> mockLog = <span class="hljs-module-identifier">Mock</span>.mock1(_ =&gt; ());
<span class="hljs-keyword">module</span> <span class="hljs-module-identifier">MyModule</span> =
  <span class="hljs-module-identifier">RelyTalk</span>.<span class="hljs-module-identifier">MyModule</span>.<span class="hljs-module-identifier">Make</span>({
    <span class="hljs-keyword">let</span> log = <span class="hljs-module-identifier">Mock</span>.fn(mockLog);
  });

<span class="hljs-keyword">let</span> {describe} =
  describeConfig
  <span class="hljs-operator">|&gt;</span> withLifecycle(testLifecycle =&gt;
       testLifecycle <span class="hljs-operator">|&gt;</span> beforeEach(() =&gt; <span class="hljs-module-identifier">Mock</span>.reset(mockLog))
     )
  <span class="hljs-operator">|&gt;</span> build;

describe(<span class="hljs-string">"MyModule"</span>, ({test}) =&gt; {
  test(<span class="hljs-string">"Should log a start message"</span>, ({expect}) =&gt; {
    <span class="hljs-module-identifier">MyModule</span>.doSomethingThatGetsLogged();
    expect.mock(mockLog).toBeCalledWith(<span class="hljs-string">"starting to do something"</span>);
  });
  test(<span class="hljs-string">"should log a completion message"</span>, ({expect}) =&gt; {
    <span class="hljs-module-identifier">MyModule</span>.doSomethingThatGetsLogged();
    expect.mock(mockLog).toBeCalledWith(<span class="hljs-string">"did the thing!"</span>);
  });
});
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="api-reference"></a><a href="#api-reference" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API reference</h2>
<h3><a class="anchor" aria-hidden="true" id="mockchangeimplementationimplementation-mock"></a><a href="#mockchangeimplementationimplementation-mock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.changeImplementation(implementation, mock)</h3>
<p>Accepts an implementation to be used for calls to the underlying mock function. The original implementation passed to the Mock constructor can be restored via <a href="#mockresetmock"><code>Mock.reset</code></a> or <a href="#mockresetimplementationmock"><code>Mock.resetImplementation</code></a>.</p>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">open</span> <span class="hljs-module-identifier">TestFramework</span>;

describe(<span class="hljs-string">"Mock.changeImplementation"</span>, ({test}) =&gt; {
  test(<span class="hljs-string">"changes function implementation"</span>, ({expect}) =&gt; {
    <span class="hljs-keyword">let</span> mock = <span class="hljs-module-identifier">Mock</span>.mock1(() =&gt; <span class="hljs-number">42</span>);
    <span class="hljs-keyword">let</span> fn = <span class="hljs-module-identifier">Mock</span>.fn(mock);
    expect.int(fn()).toBe(<span class="hljs-number">42</span>);

    <span class="hljs-module-identifier">Mock</span>.changeImplementation(() =&gt; <span class="hljs-number">43</span>, mock);

    expect.int(fn()).toBe(<span class="hljs-number">43</span>);
  });
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="mockresetmock"></a><a href="#mockresetmock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.reset(mock)</h3>
<p>Resets all information relating to stored calls and results, as well as restoring the mock to the original implementation it was constructed with.</p>
<p>Equivalent to calling both <a href="#mockresethistorymock"><code>Mock.resetHistory</code></a> and <a href="#mockresetimplementationmock"><code>Mock.resetImplementation</code></a></p>
<h3><a class="anchor" aria-hidden="true" id="mockresethistorymock"></a><a href="#mockresethistorymock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.resetHistory(mock)</h3>
<p>Resets all information relating to stored calls and results.</p>
<p>Often this is useful when you want to clean up a mock's usage data between two assertions.</p>
<h3><a class="anchor" aria-hidden="true" id="mockresetimplementationmock"></a><a href="#mockresetimplementationmock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.resetImplementation(mock)</h3>
<p>Restores the original mock implementation to what it was first constructed with, regardless of how many times <a href="#mockchangeimplementationimplementation-mock"><code>Mock.changeImplementation</code></a> has been called.</p>
<h3><a class="anchor" aria-hidden="true" id="mockgetcallsmock"></a><a href="#mockgetcallsmock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.getCalls(mock)</h3>
<p>Returns a list of the arguments that have been passed to the underlying function. The calls are ordered from most to least recent. Generally the <a href="/docs/rely/expect#expectmock">built in mock matchers</a> should be used instead of <code>Mock.getCalls</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="mockgetresultsmock"></a><a href="#mockgetresultsmock" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock.getResults(mock)</h3>
<p>Returns a list of <code>Mock.result</code> from the underlying function. The calls are ordered from most to least recent. Generally the <a href="/docs/rely/expect#expectmock">built in mock matchers</a> should be used instead of <code>Mock.getResults</code>.</p>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">Mock</span> = {
  <span class="hljs-keyword">type</span> result('a) =
    | <span class="hljs-constructor">Return</span>('a)
    | <span class="hljs-constructor">Exception</span>(exn, option(<span class="hljs-module-identifier">Printexc</span>.location), string);
};
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/rely/setup-teardown"><span class="arrow-prev">← </span><span>Setup and Teardown</span></a><a class="docs-next button" href="/docs/rely/api"><span>Basic API</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#using-mock-functions">Using Mock Functions</a><ul class="toc-headings"><li><a href="#creating-mocks">Creating Mocks</a></li><li><a href="#calling-mock-functions">Calling Mock Functions</a></li><li><a href="#injecting-via-functor">Injecting via Functor</a></li></ul></li><li><a href="#api-reference">API reference</a><ul class="toc-headings"><li><a href="#mockchangeimplementationimplementation-mock">Mock.changeImplementation(implementation, mock)</a></li><li><a href="#mockresetmock">Mock.reset(mock)</a></li><li><a href="#mockresethistorymock">Mock.resetHistory(mock)</a></li><li><a href="#mockresetimplementationmock">Mock.resetImplementation(mock)</a></li><li><a href="#mockgetcallsmock">Mock.getCalls(mock)</a></li><li><a href="#mockgetresultsmock">Mock.getResults(mock)</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo-inverted.svg" alt="Reason Native" width="66" height="58"/></a><div><h5>Projects</h5><a href="/docs/rely">Rely</a><a href="/docs/console">Console</a><a href="/docs/pastel">Pastel</a><a href="/docs/refmterr">Refmterr</a><a href="/docs/file-context-printer">File Context Printer</a></div><div><h5>More</h5><a href="https://github.com/facebookexperimental/reason-native">GitHub</a><a class="github-button" href="https://github.com/facebookexperimental/reason-native" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook Inc.</section></footer></div></body></html>